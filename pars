def retrieve_data(self, query, max_per_page=200000):
    if self.pool_conn:
        with self.conn.acquire() as connection:
            with connection.cursor() as cursor:
                cursor.execute(query)
                columns = [col[0] for col in cursor.description]
                res = pl.DataFrame(schema=columns)

                while True:
                    rows = cursor.fetchmany(max_per_page)
                    if not rows:
                        break
                    res = pl.concat(
                        items=[res, pl.DataFrame(rows, schema=columns)],
                        how="vertical"
                    )
                connection.commit()
                return res
    else:
        self.cur.execute(query)
        columns = [col[0] for col in self.cur.description]
        res = pl.DataFrame(schema=columns)

        while True:
            rows = self.cur.fetchmany(max_per_page)
            if not rows:
                break
            res = pl.concat(
                items=[res, pl.DataFrame(rows, schema=columns)],
                how="vertical"
            )
        self.conn.commit()
        return res